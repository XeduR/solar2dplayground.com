<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Solar2D, HTML5, Lua, gamedev, game development, open source, sandbox, playground, XeduR, Eetu Rantanen">
    <meta name="description" content="Solar2D Playground is an interactive website that allows you to create and run Solar2D projects instantly online.">
    <meta name="author" content="Eetu Rantanen">
    
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="./js/codemirror/lib/codemirror.js"></script>
    <script src="./js/codemirror/lua.js"></script>
    <script src="./js/codemirror/simplescrollbars.js"></script>
    <script src="./js/detectMobile.js"></script>
    <script src="./js/handleCode.js"></script>
    <script src="./js/panel.js"></script>
    <link href="./js/codemirror/dracula.css" rel="stylesheet"/>
    <link href="./js/codemirror/lib/codemirror.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    
    <title>Solar2D Playground</title>
</head>

<body>
    <div class="container">
        <main class="content">
            <div id="wrapper">
                <nav>
                    <ul class="menu">
                        <li class="logo"><a href="#"><img class="logo-image" src="img/logo.png" alt="Solar2D Playground"></a></li>
                        <div id="break"></div>
                        <li class="item"><button id="code" class="button-header" onclick="togglePanel('code')">Code</button></li>
                        <li class="item"><button id="info" class="button-header" onclick="togglePanel('info')">Info</button></li>
                        <li class="item last"><a href="https://solar2d.com/" target="_blank">Get Solar2D</a></li>
                    </ul>
                </nav>
                
        		<noscript><h4>JavaScript disabled. You must enable JavaScript to use the Playground.</h4></noscript>
                <div class="mobile"><p class="hidden" id="disclaimer"></p></div>
                
                <div id="panel-code" class="panel">
                    <span onclick="closePanel('code')" class="close-button">x</span>
                    
                    <div class="segment">
                        <div id="line"></div>
                        <h2>Select Sample Project:</h2>
                        <div id="sample-buttons"></div>
                        <div id="line"></div>
                    </div>
                </div>
                
                <div id="panel-info" class="panel">
                    <span onclick="closePanel('info')" class="close-button">x</span>
                    
                    <div class="segment">
                        <div id="line"></div>
                        <h2>Solar2D Playground:</h2>
                        <p>Solar2D Playground is an interactive website, developed and maintained by <a href="https://www.erantanen.com">Eetu Rantanen</a>, that allows you to create and run Solar2D projects instantly online.</p>
                        <p>You can find more of my personal projects over at my code portfolio site: <a href="https://www.xedur.com">www.xedur.com</a>.
                            I work on all sorts of interesting projects, as well as plugins for Solar2D, in my free time.
                            If you like what I'm doing and wish to support me, then <a href="https://ko-fi.com/xedur">consider buying me a cup of coffee over at Ko-fi</a>.</p>
                        <button class="kofi"><span><a href="https://ko-fi.com/xedur"><img src="./img/support-me.svg" max-width="306" width="100%"></a></span></button>
                        <div id="line"></div>
                        <h2>Playground limitations & Solar2D:</h2>
                        <p>For convenience sake, and due to issues like CORS, Solar2D Playground does not support network requests or sockets.
                            This means that you are limited to using the assets that are included in Solar2D Playground. Solar2D's HTML5 builds are also still in beta.</p>
                        <p>If you wish to develop games and apps without any such limitations, then <a href="https://solar2d.com/" target="_blank">download Solar2D</a>, a free and open source game engine.</p>
                        <p>Solar2D development is sponsored by its users. Support the project on <a href="https://github.com/sponsors/shchvova">GitHub Sponsors</a> or <a href="https://www.patreon.com/shchvova">Patreon</a>.</p>
                        <div id="line"></div>
                        <p>In true open source spirit, the entire <a href="https://github.com/XeduR/solar2dplayground.com">Solar2D Playground source</a> is available under the MIT License.</p>
                        <div id="line"></div>
                    </div>
                </div>
                
                <div class="column-left">
                    <textarea id="editor"></textarea>
                </div>
                
                <div class="column-right">
                    <div class="iframe-container">
                        <iframe id="app-frame" src="app/index.html"></iframe>
                    </div>
                </div>
            
                <script>
                    var sampleProject;
                    var appModule;
                    var getHeight;
                    var hasLoaded = false;
                        
                    if (window.mobileCheck()) {
                        document.getElementById("disclaimer").innerHTML = "You seem to be on a mobile device. This website is not designed for mobile devices and it may not run correctly or at all on your device.";
                        document.getElementById("disclaimer").style.padding = "24px";
                        document.getElementById("disclaimer").style.margin = "0px";
                        document.getElementById("disclaimer").style.background = "#d10000";
                        document.getElementById("disclaimer").style.color = "white";
                    }
                    // Match the code editor's height with the app's height.
                    function resizeEditor(){
                        editor.setSize(null,getHeight());
                    }
                    
                    var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
                        mode: "lua",
                        theme: "dracula",
                        lineNumbers: true,
                        scrollbarStyle: "simple"
                    });
                    // Give the editor an initial height based on the height of the window and aspect ratio of the app.
                    // The more accurate height will be later assigned via resizeEditor when the app has loaded.
                    var widthInitial = document.documentElement.clientWidth;
                    widthInitial = widthInitial*0.5*0.6666;
                    editor.setSize(null, Math.min(widthInitial,960));

                    $.ajax({
                        url: "./demos/demos.json",
                        type: "HEAD",
                        error: function() {
                            document.getElementById("disclaimer").innerHTML = "There was a problem with loading the sample projects. Try again later.";
                            document.getElementById("disclaimer").style.padding = "20px";
                            document.getElementById("disclaimer").style.margin = "0px";
                            document.getElementById("sample-buttons").innerHTML = "<p>Failed to load sample projects.</p>";
                        },
                        success: function() {
                            $.getJSON( "./demos/demos.json", function(json) {
                                sampleProject = json;
                                
                                var buttons = "";
                                for (var i = 0; i < sampleProject.length; i++) {
                                    buttons += '<button id="project-'+i+'" class="button-code" onclick="loadCode('+i+')">'+sampleProject[i].title+'</button>'
                                }
                                document.getElementById("sample-buttons").innerHTML = buttons;
                                // Open the code panel and crate project by default.
                                document.getElementById("code").click();
                                document.getElementById("project-1").click();
                            });
                        }
                    });
                    // It's unclear as to when the app has finished loading and when Module and its functions are
                    // available, so keep checking until they are, and then finalise the site's functionality.
                    function finalise() {
                        hasLoaded = true;
                        appModule = document.getElementById("app-frame").contentWindow.Module;
                        getHeight = appModule.cwrap( "jsContextGetWindowHeight" );
                        editor.setSize(null,getHeight());
                        window.addEventListener("resize", resizeEditor);
                    }
                    function checkLoaded() {
                        if (document.getElementById("app-frame").contentWindow.Module && document.getElementById("app-frame").contentWindow.Module.cwrap) {
                            clearInterval(loader);
                            finalise();
                        }
                    }
                    var loader = setInterval(checkLoaded, 100);
                </script>
            </div>    
        </main>
            
        <footer>
            <p style="line-height: 2">
                <a href="https://www.erantanen.com/">Solar2D Playground © 2020 Eetu Rantanen</a><br>
                Solar2D logo is property of the <a href="https://solar2d.com/">Solar2D project</a>.
                The images used in the app are courtesy of <a href="https://ponywolf.com/">Ponywolf</a>.
            </p>
        </footer>
    </div>
</body>
</html>
